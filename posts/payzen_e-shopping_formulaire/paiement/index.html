<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Payzen e-shopping formulaire - Paiement | HUANG Manutea</title><meta name=keywords content><meta name=description content="Cet article fait partie d&rsquo;une suite de tutoriels d&rsquo;intégration Payzen dans une application web d&rsquo;e-shopping. Vous trouverez le précédent article ici.
Introduction Après voir créé l&rsquo;inventaire, nous allons maintenant implémenter le paiement, et plus particulièrement le paiement comptant immédiat.
User Story En tant qu&rsquo;utilisateur Je veux payer le produit sélectionné Afin de créer une commande Déroulement Pour faire ce paiement, nous utilisons la librairie PayzenJS.
La documentation de cette librairie nous indique que nous devons signer notre requête de génération de formulaire via une requête POST vers un backend, ce qui coïncide avec la documentation Payzen de paiement comptant immédiat."><meta name=author content="HUANG Manutea"><link rel=canonical href=https://huangmanutea.github.io/blog.dev/posts/payzen_e-shopping_formulaire/paiement/><link crossorigin=anonymous href=/blog.dev/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog.dev/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://huangmanutea.github.io/blog.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://huangmanutea.github.io/blog.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://huangmanutea.github.io/blog.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://huangmanutea.github.io/blog.dev/apple-touch-icon.png><link rel=mask-icon href=https://huangmanutea.github.io/blog.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.100.1"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-228910148-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Payzen e-shopping formulaire - Paiement"><meta property="og:description" content="Cet article fait partie d&rsquo;une suite de tutoriels d&rsquo;intégration Payzen dans une application web d&rsquo;e-shopping. Vous trouverez le précédent article ici.
Introduction Après voir créé l&rsquo;inventaire, nous allons maintenant implémenter le paiement, et plus particulièrement le paiement comptant immédiat.
User Story En tant qu&rsquo;utilisateur Je veux payer le produit sélectionné Afin de créer une commande Déroulement Pour faire ce paiement, nous utilisons la librairie PayzenJS.
La documentation de cette librairie nous indique que nous devons signer notre requête de génération de formulaire via une requête POST vers un backend, ce qui coïncide avec la documentation Payzen de paiement comptant immédiat."><meta property="og:type" content="article"><meta property="og:url" content="https://huangmanutea.github.io/blog.dev/posts/payzen_e-shopping_formulaire/paiement/"><meta property="og:image" content="https://huangmanutea.github.io/blog.dev/Papeete.JPG"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-21T22:31:25-10:00"><meta property="article:modified_time" content="2022-05-21T22:31:25-10:00"><meta property="og:site_name" content="Yet Another Tahitian Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://huangmanutea.github.io/blog.dev/Papeete.JPG"><meta name=twitter:title content="Payzen e-shopping formulaire - Paiement"><meta name=twitter:description content="Cet article fait partie d&rsquo;une suite de tutoriels d&rsquo;intégration Payzen dans une application web d&rsquo;e-shopping. Vous trouverez le précédent article ici.
Introduction Après voir créé l&rsquo;inventaire, nous allons maintenant implémenter le paiement, et plus particulièrement le paiement comptant immédiat.
User Story En tant qu&rsquo;utilisateur Je veux payer le produit sélectionné Afin de créer une commande Déroulement Pour faire ce paiement, nous utilisons la librairie PayzenJS.
La documentation de cette librairie nous indique que nous devons signer notre requête de génération de formulaire via une requête POST vers un backend, ce qui coïncide avec la documentation Payzen de paiement comptant immédiat."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://huangmanutea.github.io/blog.dev/posts/"},{"@type":"ListItem","position":2,"name":"","item":"https://huangmanutea.github.io/blog.dev/posts/payzen_e-shopping_formulaire/"},{"@type":"ListItem","position":3,"name":"Payzen e-shopping formulaire - Paiement","item":"https://huangmanutea.github.io/blog.dev/posts/payzen_e-shopping_formulaire/paiement/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Payzen e-shopping formulaire - Paiement","name":"Payzen e-shopping formulaire - Paiement","description":"Cet article fait partie d\u0026rsquo;une suite de tutoriels d\u0026rsquo;intégration Payzen dans une application web d\u0026rsquo;e-shopping. Vous trouverez le précédent article ici.\nIntroduction Après voir créé l\u0026rsquo;inventaire, nous allons maintenant implémenter le paiement, et plus particulièrement le paiement comptant immédiat.\nUser Story En tant qu\u0026rsquo;utilisateur Je veux payer le produit sélectionné Afin de créer une commande Déroulement Pour faire ce paiement, nous utilisons la librairie PayzenJS.\nLa documentation de cette librairie nous indique que nous devons signer notre requête de génération de formulaire via une requête POST vers un backend, ce qui coïncide avec la documentation Payzen de paiement comptant immédiat.","keywords":[],"articleBody":"Cet article fait partie d’une suite de tutoriels d’intégration Payzen dans une application web d’e-shopping. Vous trouverez le précédent article ici.\nIntroduction Après voir créé l’inventaire, nous allons maintenant implémenter le paiement, et plus particulièrement le paiement comptant immédiat.\nUser Story En tant qu’utilisateur Je veux payer le produit sélectionné Afin de créer une commande Déroulement Pour faire ce paiement, nous utilisons la librairie PayzenJS.\nLa documentation de cette librairie nous indique que nous devons signer notre requête de génération de formulaire via une requête POST vers un backend, ce qui coïncide avec la documentation Payzen de paiement comptant immédiat.\nNous allons donc tout d’abord créer un formulaire dans notre frontend, puis nous passerons les valeurs des champs dans la propriété orderData de la librarie.\nEnsuite nous implémenterons la génération de signature dans le backend, pour enfin renseigner l’url de l’endpoint dans la propriété credentials de la librairie.\nNous renseignerons également la propriété target comme étant égale à secure.osb.pf, afin d’utiliser la plateforme spécifique à OSB, car c’est celle-ci qui accepte les cartes privatives.\nEnfin, nous renseignerons la propriété canvas, qui contiendra l’iframe contenant le formulaire de paiement final.\nLa librarie s’occupera de faire la requête POST vers le backend, de récupérer la signature, d’envoyer la requêté signée à la plateforme, et enfin d’afficher le formulaire dans l’iframe.\nFrontend Item Dans un premier temps, modifions notre composant Item comme suit :\n// components/item.js export default function Item({item, buy}) { return ( \u003cdiv className=\"bg-white shadow overflow-hidden sm:rounded-lg hover:opacity-75\"\u003e \u003cdiv className=\"flex flex-col p-4 border-b border-gray-200\"\u003e \u003cdiv className=\"flex flex-row gap-1\"\u003e \u003ch2\u003eName:\u003c/h2\u003e \u003cp\u003e{item.name}\u003c/p\u003e \u003c/div\u003e \u003cdiv className=\"flex flex-row gap-1\"\u003e \u003ch2\u003ePrice:\u003c/h2\u003e \u003cp\u003e{item.price} \u003cspan\u003eXPF\u003c/span\u003e\u003c/p\u003e \u003c/div\u003e \u003c/div\u003e \u003cdiv className=\"flex flex-col p-4\"\u003e \u003cbutton type=\"button\" className=\"custom-button custom-button-primary\" onClick={() =\u003e buy(item)}\u003eBuy\u003c/button\u003e \u003c/div\u003e \u003c/div\u003e ) } Nous avons enlevé la classe cursor-pointer de la div principale, afin d’utiliser un bouton à la place (meilleur pour l’accessibilité web).\nEnsuite nous avons placé la fonction buy dans les props du composant afin que le parent ait le contrôle de la fonction à exécuter.\nEnfin, si vous voulez savoir comment est stylisé le bouton, le style se trouve dans le fichier global.css :\n/* styles/global.css */ @tailwind base; @tailwind components; @tailwind utilities; body { @apply bg-gray-200; } .custom-button { @apply w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 text-base text-center font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 sm:w-auto sm:text-sm; } .custom-button-primary { @apply bg-teal-600 text-white hover:bg-teal-700 focus:ring-teal-500; } Modal Maintenant nous devons implémenter la fonction buy dans le parent, qui est le fichier index.js. Mais nous allons être confrontés à un problème, en effet, cette fonction va utiliser la librairie PayzenJS, qui va afficher le formulaire de paiement dans une iframe.\nNous ne voulons pas afficher l’iframe telle quelle dans la page, ce n’est pas très esthétique.\nÀ la place, nous voulons afficher cette iframe dans un composant Modal, qui sera par défaut cachée, qui s’affichera au clic sur un bouton Buy, et qui pourra être fermée.\nAfin d’avoir un meilleur affichage de l’iframe dans la modale, nous allons utiliser la librarie @tailwindcss/aspect-ratio et plus particulièrement les classes aspect-w-1 et aspect-h-1.\n/* package.json */ \"devDependencies\": { \"@tailwindcss/aspect-ratio\": \"^0.4.0\", [...] } npm install touch components/modal.js // components/modal.js export default function Modal({content, close}) { return ( \u003cdiv className=\"relative z-10\" aria-labelledby=\"modal-title\" role=\"dialog\" aria-modal=\"true\"\u003e \u003cdiv className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\"\u003e\u003c/div\u003e \u003cdiv className=\"fixed z-10 inset-0 overflow-y-auto\"\u003e \u003cdiv className=\"flex items-end sm:items-center justify-center min-h-full p-4 text-center sm:p-0\"\u003e \u003cdiv className=\"relative bg-white rounded-lg shadow-xl\"\u003e \u003cdiv className=\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\"\u003e \u003cdiv className=\"flex flex-col gap-2\"\u003e \u003cdiv className=\"flex flex-row justify-end\"\u003e \u003cbutton className=\"text-xl text-gray-500 font-bold\" onClick={() =\u003e close()}\u003eX\u003c/button\u003e \u003c/div\u003e \u003cdiv className=\"flex content-center justify-center aspect-w-1 aspect-h-1\"\u003e {content} \u003c/div\u003e \u003c/div\u003e \u003c/div\u003e \u003c/div\u003e \u003c/div\u003e \u003c/div\u003e \u003c/div\u003e ) } La prop content est un slot, c’est dans cette prop qu’on mettra l’iframe.\nLa prop close est une fonction qui sera appelée lorsqu’on voudra fermer la modale sans poursuivre le paiement.\nIl nous reste maintenant à gérer l’affichage de cette modale, c’est dans le parent, index.js que nous allons le faire :\n// pages/index.js import Head from 'next/head'; import Item from '../components/item'; import Modal from '../components/modal'; import * as React from \"react\"; export default function Home({ data }) { const [displayModal, setDisplayModal] = React.useState(false) const buy = (item) =\u003e { setDisplayModal(true); // TODO paiement } const onCloseModal = () =\u003e { setDisplayModal(false); } return ( \u003cdiv className=\"flex flex-col p-2\"\u003e \u003cHead\u003e \u003ctitle\u003eTutoriel Payzen e-shopping\u003c/title\u003e \u003clink rel=\"icon\" href=\"/favicon.ico\" /\u003e \u003c/Head\u003e \u003cmain\u003e \u003cdiv className='flex flex-row content-center justify-center'\u003e \u003cdiv className='flex flex-col content-center justify-center gap-2'\u003e \u003ch1 className=\"font-bold text-lg text-gray-600 text-center\"\u003eBoutique\u003c/h1\u003e \u003cdiv className='grid grid-cols-4 grid-flow-row gap-2'\u003e {data.inventory.map((item, i) =\u003e \u003cItem key={i} item={item} buy={buy}/\u003e)} \u003c/div\u003e \u003c/div\u003e \u003c/div\u003e \u003cdiv className={displayModal ? 'block' : 'hidden'}\u003e \u003cModal content={\u003cdiv id=\"paymentCanvas\"\u003e\u003c/div\u003e} close={onCloseModal}\u003e\u003c/Modal\u003e \u003c/div\u003e \u003c/main\u003e \u003c/div\u003e ) } Nous utilisons le hook useState afin de gérer l’état d’affichage de la modale.\nRetour de paiement Une fois que le paiement sera fait, comme le décrit la documentation Payzen du formulaire de paiement, nous serons redirigés vers l’url correspondante: vads_url_success en cas de paiement validé, vads_url_return en cas de paiement refusé.\nNous allons donc créer 2 pages, success.js et fail.js qui nous serviront de callback url, ces pages nous permettront aussi de retourner sur la page principale.\nmkdir pages/payment-result touch pages/payment-result/fail.js touch pages/payment-result/success.js // pages/payment-result/fail.js import { useRouter } from 'next/router' export default function Fail() { const router = useRouter() return ( \u003cdiv className=\"flex flex-col gap-4\"\u003e \u003ch1\u003ePaiement échoué\u003c/h1\u003e \u003cbutton className='custom-button custom-button-primary' onClick={() =\u003e router.push('/')}\u003eRetour\u003c/button\u003e \u003c/div\u003e ) } // pages/payment-result/success.js import { useRouter } from 'next/router' export default function Success() { const router = useRouter() return ( \u003cdiv className=\"flex flex-col gap-4\"\u003e \u003ch1\u003ePaiement réussi\u003c/h1\u003e \u003cbutton className='custom-button custom-button-primary' onClick={() =\u003e router.push('/')}\u003eRetour\u003c/button\u003e \u003c/div\u003e ) } PayzenJS Nos composants sont prêts, on passe à l’implémentation du paiement, procédons à l’installation de PayzenJS.\n/* package.json */ \"dependencies\": { \"next\": \"latest\", \"PayzenJS\": \"1.0.5\", \"react\": \"17.0.2\", \"react-dom\": \"17.0.2\" }, npm install La librarie PayzenJS a besoin que le DOM soit initialisé, le plus simple pour nous est de charger cette librarie via le hook useEffect qui permet d’avoir un comportement proche de la fonction componentDidMount d’un React.Component, qui se lance une fois le DOM chargé.\n// pages/index.js [...] import * as React from \"react\"; let PayzenJS; export async function getServerSideProps() { [...] } export default function Home({ data }) { const [displayModal, setDisplayModal] = React.useState(false) React.useEffect(() =\u003e { PayzenJS = require('PayzenJS/payzenjs'); }, []); [...] } Enfin, il nous reste à utiliser cette librarie :\n// pages/index.js const buy = (item) =\u003e { setDisplayModal(true); PayzenJS.go({ // plateforme Payzen à utiliser, ne pas changer target: \"secure.osb.pf\", // données du canvas où l'iframe sera intégré canvas: { id: \"paymentCanvas\", // id de la div cible width: \"1000px\", // largeur de l'iframe height: \"1000px\" // hauteur de l'iframe }, /* données du formulaire, * cf. doc : https://secure.osb.pf/doc/fr-FR/form-payment/standard-payment/creer-un-paiement-comptant-immediat.html * cf. doc : https://secure.osb.pf/doc/fr-FR/form-payment/standard-payment/gerer-les-moyens-de-paiement-proposes-a-l-acheteur.html */ orderData: { vads_action_mode: \"INTERACTIVE\", vads_order_id: `TEST-${Math.round(Math.random() * 1000)}`, vads_site_id: \"12345678\", vads_ctx_mode: \"TEST\", // TEST | PRODUCTION vads_amount: item.price, vads_currency: \"953\", // XPF vads_payment_cards: \"\", // laisser vide pour afficher tous les types de cartes vads_language: \"fr\", // laisser 'fr' car par défaut c'est la langue 'en' vads_theme_config: 'MODE_IFRAME=false;FORM_TARGET=_top', // affichage et comportement du theme, MODE_IFRAME=false =\u003e affichage complet, FORM_TARGET=_top =\u003e navigation vads_redirect_success_timeout: 5, // timeout du redirect après paiement accepté vads_redirect_error_timeout: 3, // timeout du redirect après paiement refusé vads_url_success: `http://localhost:3000/payment-result/success`, // url retour paiement accepté vads_url_return: `http://localhost:3000/payment-result/fail`, // url retour paiement refusé vads_return_mode: \"POST\" // valeur nécessaire pour que le mode d'affichage de la page de retour soit pris en compte }, credentials : { // endpoint retournant la signature du formulaire, cf. dossier backend source: `http://localhost:3001/sign` } }); } C’est tout pour notre frontend, passons maintenant au backend.\nBackend Pour notre backend, nous stockerons d’abord notre certificat dans un fichier .env afin de ne pas le mettre en dur dans le code (et de ne pas le mettre dans git), en utilisant la librarie dotenv.\nNous ferons des requêtes à partir d’un autre serveur (le frontend est sur le port 3000, et le backend sur le port 3001), et donc être confrontés à un problème de CORS, c’est pourquoi nous utiliserons le module cors.\nDe plus, la librarie PayzenJS nous enverra un formulaire sous forme d’objet JSON, pour pouvoir l’interpréter, nous utilisons body-parser.\nEnfin, nous devrons hasher et signer les données de notre formulaire, nous utiliserons la librarie crypto-js pour cela.\nCe qui nous donne les dépendances suivantes :\n/* package.json */ \"dependencies\": { \"express\": \"4.17.2\", \"cors\": \"2.8.5\", \"crypto-js\": \"4.1.1\", \"dotenv\": \"16.0.0\", \"body-parser\": \"1.20.0\" } Installez les modules :\nnpm install Dotenv Dans le dossier backend, placez le certificat dans un fichier .env :\ntouch .env # .env CERTIFICATE= Et récupérez-le dans le serveur :\n// main.js require('dotenv').config(); // modules serveur const express = require(\"express\"); [...] // clé de la boutique disponible dans le back office commerçant Payzen const certificate = process.env.CERTIFICATE; [...] CORS Utilisez cors dans votre serveur:\n// main.js // modules serveur const express = require(\"express\"); const cors = require('cors'); [...] // middlewares app.use(cors()); app.options('*', cors()); [...] Body-parser Utlisez body-parser dans votre serveur :\n// main.js const cors = require('cors'); const bodyParser = require('body-parser'); [...] // middlewares app.use(cors()); app.options('*', cors()); app.use(bodyParser.json()); [...] Signature Avant de commencer à utiliser crypto-js, nous devons savoir quelles fonctions de cette librarie nous allons utiliser.\nCette documentation nous indique que nous devons utiliser hmacSHA256 et Base64.\nNous devons trier les noms de champs commençant par “vads_” par ordre alphabétique, concaténer leur valeur associée dans une variable, séparées par des “+”, et rajouter le certificat à la fin de cette variable.\nCe qui nous donne finalement ce fichier main.js :\n// main.js // dotenv require('dotenv').config(); // modules serveur const express = require(\"express\"); const cors = require('cors'); const bodyParser = require('body-parser'); // modules signature const hmacSHA256 = require('crypto-js/hmac-sha256'); const Base64 = require('crypto-js/enc-base64'); const app = express(); const port = 3001; // middlewares app.use(cors()); app.options('*', cors()); app.use(bodyParser.json()); // clé de la boutique disponible dans le back office commerçant Payzen const certificate = process.env.CERTIFICATE; app.post(\"/sign\", (req, res) =\u003e { var orderData = req.body; console.log(orderData); // transformer les données de orderData en chaine : \"VALEUR_1+VALEUR_2+...+VALEUR_N+CERTIFICAT\" let dataToSign = \"\"; Object.keys(orderData).sort().forEach((key) =\u003e { if(key.slice(0,5) === 'vads_') { dataToSign += `${orderData[key]}+`; } }) dataToSign += `${certificate}`; // calcul de la signature, l'algorithme à utiliser est défini dans le back office commerçant Payzen let signature = Base64.stringify(hmacSHA256(dataToSign, certificate)); // retourner la signature res.send({signature: signature}); }); app.listen(port, () =\u003e { console.log(`Payzen e-shopping backend server listening on port ${port}`); }); Test Nous sommes maintenant prêts à tester notre application.\nEn cliquant sur le bouton Buy du premier Item nous voyons le formulaire de paiement s’afficher dans la modale.\nAttention: les données de test sont uniquement possibles si vous avez bien spécifié la valeur TEST dans le paramètre vads_ctx_mode.\nEn cliquant sur une des cartes, par exemple “Banque Socredo Verte”, nous voyons une liste de cartes de test. En cliquant sur l’une d’entre elle, le formulaire va automatiquement remplir les champs.\nRemarque : À côté de chaque carte se trouve un scénario associé, si vous voulez tester un paiement accepté, vous devez choisir la 1ère carte.\nPuis, en cliquant sur valider, vous verrez le formulaire pour le code reçu par SMS, aussi appelé OTP pour One Time Password.\nEn mode TEST, vous pouvez juste recopier la valeur affichée, ou cliquer sur la valeur.\nEnfin, si vous avez bien choisi la carte associé au “paiement accepté”, vous obtiendrez l’écran de commande validée.\nVous pouvez ensuite soit attendre la redirection automatique, soit cliquer sur “retourner à la boutique”, pour aller sur la page /payment-result/success.\nNous voyons dans les DevTools que cette redirection est en fait une requête POST, avec les données suivantes.\nConclusion Dans cet article, nous avons utilisé la librarie PayzenJS afin d’afficher le formulaire de paiement dans une iframe contenue dans une modale.\nNous avons ainsi réussi à faire un paiement, et nous avons été redirigé vers la page de paiement réussi de notre application web.\nMais le travail ne s’arrête pas ici, en effet, une fois que le paiement est effectué, validé ou non, il nous reste à exploiter les données de retour afin de déclencher la suite de la commande, ou d’avertir le client que sa commande n’est pas passée.\nDe plus, nous devons valider qu’il s’agit bien de notre transaction, et non d’une requête forgée.\nNous verrons cela dans le prochain article.\n","wordCount":"2017","inLanguage":"en","datePublished":"2022-05-21T22:31:25-10:00","dateModified":"2022-05-21T22:31:25-10:00","author":{"@type":"Person","name":"HUANG Manutea"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://huangmanutea.github.io/blog.dev/posts/payzen_e-shopping_formulaire/paiement/"},"publisher":{"@type":"Organization","name":"HUANG Manutea","logo":{"@type":"ImageObject","url":"https://huangmanutea.github.io/blog.dev/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://huangmanutea.github.io/blog.dev/ accesskey=h title="HUANG Manutea (Alt + H)">HUANG Manutea</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://huangmanutea.github.io/blog.dev/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://huangmanutea.github.io/blog.dev/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://huangmanutea.github.io/blog.dev/>Home</a>&nbsp;»&nbsp;<a href=https://huangmanutea.github.io/blog.dev/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://huangmanutea.github.io/blog.dev/posts/payzen_e-shopping_formulaire/></a></div><h1 class=post-title>Payzen e-shopping formulaire - Paiement</h1><div class=post-meta><span title='2022-05-21 22:31:25 -1000 -1000'>May 21, 2022</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;HUANG Manutea</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#user-story aria-label="User Story">User Story</a></li><li><a href=#d%c3%a9roulement aria-label=Déroulement>Déroulement</a></li><li><a href=#frontend aria-label=Frontend>Frontend</a><ul><li><a href=#item aria-label=Item>Item</a></li><li><a href=#modal aria-label=Modal>Modal</a></li><li><a href=#retour-de-paiement aria-label="Retour de paiement">Retour de paiement</a></li><li><a href=#payzenjs aria-label=PayzenJS>PayzenJS</a></li></ul></li><li><a href=#backend aria-label=Backend>Backend</a><ul><li><a href=#dotenv aria-label=Dotenv>Dotenv</a></li><li><a href=#cors aria-label=CORS>CORS</a></li><li><a href=#body-parser aria-label=Body-parser>Body-parser</a></li><li><a href=#signature aria-label=Signature>Signature</a></li></ul></li><li><a href=#test aria-label=Test>Test</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><p>Cet article fait partie d&rsquo;une suite de tutoriels d&rsquo;intégration Payzen dans une application web d&rsquo;e-shopping. Vous trouverez le précédent article <a href=https://huangmanutea.github.io/blog.dev/posts/payzen_e-shopping_formulaire/inventaire/>ici</a>.</p><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>Après voir créé l&rsquo;inventaire, nous allons maintenant implémenter le paiement, et plus particulièrement le <a href=https://secure.osb.pf/doc/fr-FR/form-payment/standard-payment/creer-un-paiement-comptant-immediat.html>paiement comptant immédiat</a>.</p><h1 id=user-story>User Story<a hidden class=anchor aria-hidden=true href=#user-story>#</a></h1><ol><li>En tant qu&rsquo;<strong>utilisateur</strong></li><li>Je veux <strong>payer le produit sélectionné</strong></li><li>Afin de <strong>créer une commande</strong></li></ol><h1 id=déroulement>Déroulement<a hidden class=anchor aria-hidden=true href=#déroulement>#</a></h1><p>Pour faire ce paiement, nous utilisons la librairie <a href=https://www.npmjs.com/package/PayzenJS>PayzenJS</a>.</p><p>La documentation de cette librairie nous indique que nous devons signer notre requête de génération de formulaire via une requête POST vers un backend, ce qui coïncide avec la documentation Payzen de paiement comptant immédiat.</p><p><img loading=lazy src=payzenjs_signature.png#center alt=signature title=signature></p><p>Nous allons donc tout d&rsquo;abord créer un formulaire dans notre frontend, puis nous passerons les valeurs des champs dans la propriété <em>orderData</em> de la librarie.</p><p>Ensuite nous implémenterons la génération de signature dans le backend, pour enfin renseigner l&rsquo;url de l&rsquo;endpoint dans la propriété <em>credentials</em> de la librairie.</p><p>Nous renseignerons également la propriété <em>target</em> comme étant égale à <strong>secure.osb.pf</strong>, afin d&rsquo;utiliser la plateforme spécifique à OSB, car c&rsquo;est celle-ci qui <em><strong>accepte les cartes privatives</strong></em>.</p><p>Enfin, nous renseignerons la propriété <em>canvas</em>, qui contiendra l&rsquo;iframe contenant le formulaire de paiement final.</p><p>La librarie s&rsquo;occupera de faire la requête POST vers le backend, de récupérer la signature, d&rsquo;envoyer la requêté signée à la plateforme, et enfin d&rsquo;afficher le formulaire dans l&rsquo;iframe.</p><h1 id=frontend>Frontend<a hidden class=anchor aria-hidden=true href=#frontend>#</a></h1><h2 id=item>Item<a hidden class=anchor aria-hidden=true href=#item>#</a></h2><p>Dans un premier temps, modifions notre composant <em>Item</em> comme suit :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=display:flex><span><span style=color:#75715e>// components/item.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Item</span>({<span style=color:#a6e22e>item</span>, <span style=color:#a6e22e>buy</span>}) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bg-white shadow overflow-hidden sm:rounded-lg hover:opacity-75&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-col p-4 border-b border-gray-200&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-row gap-1&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>h2</span>&gt;<span style=color:#a6e22e>Name</span><span style=color:#f92672>:</span>&lt;/<span style=color:#f92672>h2</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>p</span>&gt;{<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>name</span>}&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-row gap-1&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>h2</span>&gt;<span style=color:#a6e22e>Price</span><span style=color:#f92672>:</span>&lt;/<span style=color:#f92672>h2</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>p</span>&gt;{<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>price</span>} &lt;<span style=color:#f92672>span</span>&gt;<span style=color:#a6e22e>XPF</span>&lt;/<span style=color:#f92672>span</span>&gt;&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-col p-4&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;button&#34;</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;custom-button custom-button-primary&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#a6e22e>buy</span>(<span style=color:#a6e22e>item</span>)}&gt;<span style=color:#a6e22e>Buy</span>&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Nous avons enlevé la classe <em>cursor-pointer</em> de la div principale, afin d&rsquo;utiliser un bouton à la place (meilleur pour l&rsquo;accessibilité web).</p><p>Ensuite nous avons placé la fonction buy dans les props du composant afin que le parent ait le contrôle de la fonction à exécuter.</p><p>Enfin, si vous voulez savoir comment est stylisé le bouton, le style se trouve dans le fichier global.css :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#75715e>/* styles/global.css */</span>
</span></span><span style=display:flex><span>@<span style=color:#66d9ef>tailwind</span> <span style=color:#f92672>base</span>;
</span></span><span style=display:flex><span>@<span style=color:#66d9ef>tailwind</span> <span style=color:#f92672>components</span>;
</span></span><span style=display:flex><span>@<span style=color:#66d9ef>tailwind</span> <span style=color:#f92672>utilities</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>body</span> {
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>@apply</span> <span style=color:#960050;background-color:#1e0010>bg-gray-200</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>custom-button</span> {
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>@apply</span> <span style=color:#960050;background-color:#1e0010>w-full</span> <span style=color:#960050;background-color:#1e0010>inline-flex</span> <span style=color:#960050;background-color:#1e0010>justify-center</span> <span style=color:#960050;background-color:#1e0010>rounded-md</span> <span style=color:#960050;background-color:#1e0010>border</span> <span style=color:#960050;background-color:#1e0010>border-transparent</span> <span style=color:#960050;background-color:#1e0010>shadow-sm</span> <span style=color:#960050;background-color:#1e0010>px-4</span> <span style=color:#960050;background-color:#1e0010>py-2</span> <span style=color:#960050;background-color:#1e0010>text-base</span> <span style=color:#960050;background-color:#1e0010>text-center</span> <span style=color:#960050;background-color:#1e0010>font-medium</span> focus:<span style=color:#66d9ef>outline</span><span style=color:#f92672>-</span><span style=color:#66d9ef>none</span> focus<span style=color:#f92672>:</span>ring-2 focus<span style=color:#f92672>:</span>ring-offset-2 sm<span style=color:#f92672>:</span>w-auto sm<span style=color:#f92672>:</span><span style=color:#66d9ef>text</span><span style=color:#f92672>-</span>sm;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>custom-button-primary</span> {
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>@apply</span> <span style=color:#960050;background-color:#1e0010>bg-teal-600</span> <span style=color:#960050;background-color:#1e0010>text-white</span> hover:bg-teal-700 focus<span style=color:#f92672>:</span>ring-teal-500;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=modal>Modal<a hidden class=anchor aria-hidden=true href=#modal>#</a></h2><p>Maintenant nous devons implémenter la fonction <em>buy</em> dans le parent, qui est le fichier index.js. Mais nous allons être confrontés à un problème, en effet, cette fonction va utiliser la librairie PayzenJS, qui va afficher le formulaire de paiement dans une iframe.</p><p>Nous ne voulons pas afficher l&rsquo;iframe telle quelle dans la page, ce n&rsquo;est pas très esthétique.</p><p>À la place, nous voulons afficher cette iframe dans un composant <em>Modal</em>, qui sera par défaut cachée, qui s&rsquo;affichera au clic sur un bouton <em>Buy</em>, et qui pourra être fermée.</p><p>Afin d&rsquo;avoir un meilleur affichage de l&rsquo;iframe dans la modale, nous allons utiliser la librarie <em>@tailwindcss/aspect-ratio</em> et plus particulièrement les classes <em>aspect-w-1</em> et <em>aspect-h-1</em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>/*</span> <span style=color:#960050;background-color:#1e0010>package.json</span> <span style=color:#960050;background-color:#1e0010>*/</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;devDependencies&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;@tailwindcss/aspect-ratio&#34;</span>: <span style=color:#e6db74>&#34;^0.4.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>[...]</span>
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install
</span></span><span style=display:flex><span>touch components/modal.js
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=display:flex><span><span style=color:#75715e>// components/modal.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Modal</span>({<span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>close</span>}) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;relative z-10&#34;</span> <span style=color:#a6e22e>aria</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>labelledby</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;modal-title&#34;</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dialog&#34;</span> <span style=color:#a6e22e>aria</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>modal</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fixed z-10 inset-0 overflow-y-auto&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex items-end sm:items-center justify-center min-h-full p-4 text-center sm:p-0&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;relative bg-white rounded-lg shadow-xl&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-col gap-2&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-row justify-end&#34;</span>&gt;
</span></span><span style=display:flex><span>                  &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-xl text-gray-500 font-bold&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#a6e22e>close</span>()}&gt;<span style=color:#a6e22e>X</span>&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex content-center justify-center aspect-w-1 aspect-h-1&#34;</span>&gt;
</span></span><span style=display:flex><span>                  {<span style=color:#a6e22e>content</span>}
</span></span><span style=display:flex><span>                &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>La prop <em>content</em> est un slot, c&rsquo;est dans cette prop qu&rsquo;on mettra l&rsquo;iframe.</p><p>La prop <em>close</em> est une fonction qui sera appelée lorsqu&rsquo;on voudra fermer la modale sans poursuivre le paiement.</p><p>Il nous reste maintenant à gérer l&rsquo;affichage de cette modale, c&rsquo;est dans le parent, <em>index.js</em> que nous allons le faire :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=display:flex><span><span style=color:#75715e>// pages/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Head</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;next/head&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Item</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../components/item&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Modal</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../components/modal&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Home</span>({ <span style=color:#a6e22e>data</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>displayModal</span>, <span style=color:#a6e22e>setDisplayModal</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>useState</span>(<span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>buy</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>item</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setDisplayModal</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// TODO paiement
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>onCloseModal</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setDisplayModal</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-col p-2&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Head</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>title</span>&gt;<span style=color:#a6e22e>Tutoriel</span> <span style=color:#a6e22e>Payzen</span> <span style=color:#a6e22e>e</span><span style=color:#f92672>-</span><span style=color:#a6e22e>shopping</span>&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;icon&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/favicon.ico&#34;</span> /&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>Head</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>main</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;flex flex-row content-center justify-center&#39;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;flex flex-col content-center justify-center gap-2&#39;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>h1</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;font-bold text-lg text-gray-600 text-center&#34;</span>&gt;<span style=color:#a6e22e>Boutique</span>&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;grid grid-cols-4 grid-flow-row gap-2&#39;</span>&gt;
</span></span><span style=display:flex><span>              {<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>inventory</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>item</span>, <span style=color:#a6e22e>i</span>) =&gt; &lt;<span style=color:#f92672>Item</span> <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>i</span>} <span style=color:#a6e22e>item</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>item</span>} <span style=color:#a6e22e>buy</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>buy</span>}/&gt;)}
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>displayModal</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;block&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;hidden&#39;</span>}&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>Modal</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span>{&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;paymentCanvas&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;} <span style=color:#a6e22e>close</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onCloseModal</span>}&gt;&lt;/<span style=color:#f92672>Modal</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>main</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Nous utilisons le hook <em>useState</em> afin de gérer l&rsquo;état d&rsquo;affichage de la modale.</p><h2 id=retour-de-paiement>Retour de paiement<a hidden class=anchor aria-hidden=true href=#retour-de-paiement>#</a></h2><p>Une fois que le paiement sera fait, comme le décrit la documentation Payzen du formulaire de paiement, nous serons redirigés vers l&rsquo;url correspondante: <em>vads_url_success</em> en cas de paiement validé, <em>vads_url_return</em> en cas de paiement refusé.</p><p>Nous allons donc créer 2 pages, <em>success.js</em> et <em>fail.js</em> qui nous serviront de callback url, ces pages nous permettront aussi de retourner sur la page principale.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir pages/payment-result
</span></span><span style=display:flex><span>touch pages/payment-result/fail.js
</span></span><span style=display:flex><span>touch pages/payment-result/success.js
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=display:flex><span><span style=color:#75715e>// pages/payment-result/fail.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useRouter</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;next/router&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Fail</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRouter</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-col gap-4&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h1</span>&gt;<span style=color:#a6e22e>Paiement</span> <span style=color:#a6e22e>échoué</span>&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;custom-button custom-button-primary&#39;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>push</span>(<span style=color:#e6db74>&#39;/&#39;</span>)}&gt;<span style=color:#a6e22e>Retour</span>&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=display:flex><span><span style=color:#75715e>// pages/payment-result/success.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useRouter</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;next/router&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Success</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRouter</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-col gap-4&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h1</span>&gt;<span style=color:#a6e22e>Paiement</span> <span style=color:#a6e22e>réussi</span>&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;custom-button custom-button-primary&#39;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>push</span>(<span style=color:#e6db74>&#39;/&#39;</span>)}&gt;<span style=color:#a6e22e>Retour</span>&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=payzenjs>PayzenJS<a hidden class=anchor aria-hidden=true href=#payzenjs>#</a></h2><p>Nos composants sont prêts, on passe à l&rsquo;implémentation du paiement, procédons à l&rsquo;installation de PayzenJS.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>/*</span> <span style=color:#960050;background-color:#1e0010>package.json</span> <span style=color:#960050;background-color:#1e0010>*/</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;dependencies&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;next&#34;</span>: <span style=color:#e6db74>&#34;latest&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;PayzenJS&#34;</span>: <span style=color:#e6db74>&#34;1.0.5&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;react&#34;</span>: <span style=color:#e6db74>&#34;17.0.2&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;react-dom&#34;</span>: <span style=color:#e6db74>&#34;17.0.2&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#960050;background-color:#1e0010>,</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install
</span></span></code></pre></div><p>La librarie PayzenJS a besoin que le DOM soit initialisé, le plus simple pour nous est de charger cette librarie via le hook <em>useEffect</em> qui permet d&rsquo;avoir un comportement proche de la fonction <em>componentDidMount</em> d&rsquo;un <em>React.Component</em>, qui se lance une fois le DOM chargé.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=display:flex><span><span style=color:#75715e>// pages/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>[...]
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>React</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>PayzenJS</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getServerSideProps</span>() {
</span></span><span style=display:flex><span>  [...]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Home</span>({ <span style=color:#a6e22e>data</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>displayModal</span>, <span style=color:#a6e22e>setDisplayModal</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>useState</span>(<span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>useEffect</span>(() =&gt; {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>PayzenJS</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;PayzenJS/payzenjs&#39;</span>);
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>   }, []);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   [...]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Enfin, il nous reste à utiliser cette librarie :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=display:flex><span><span style=color:#75715e>// pages/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>buy</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>item</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setDisplayModal</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>PayzenJS</span>.<span style=color:#a6e22e>go</span>({
</span></span><span style=display:flex><span>      <span style=color:#75715e>// plateforme Payzen à utiliser, ne pas changer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>target</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;secure.osb.pf&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#75715e>// données du canvas où l&#39;iframe sera intégré
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>canvas</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;paymentCanvas&#34;</span>, <span style=color:#75715e>// id de la div cible
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;1000px&#34;</span>, <span style=color:#75715e>// largeur de l&#39;iframe
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;1000px&#34;</span> <span style=color:#75715e>// hauteur de l&#39;iframe
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      },
</span></span><span style=display:flex><span>      <span style=color:#75715e>/* données du formulaire,
</span></span></span><span style=display:flex><span><span style=color:#75715e>      * cf. doc : https://secure.osb.pf/doc/fr-FR/form-payment/standard-payment/creer-un-paiement-comptant-immediat.html
</span></span></span><span style=display:flex><span><span style=color:#75715e>      * cf. doc : https://secure.osb.pf/doc/fr-FR/form-payment/standard-payment/gerer-les-moyens-de-paiement-proposes-a-l-acheteur.html
</span></span></span><span style=display:flex><span><span style=color:#75715e>      */</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>orderData</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>vads_action_mode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;INTERACTIVE&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>vads_order_id</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`TEST-</span><span style=color:#e6db74>${</span>Math.<span style=color:#a6e22e>round</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>vads_site_id</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;12345678&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>vads_ctx_mode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;TEST&#34;</span>, <span style=color:#75715e>// TEST | PRODUCTION
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_amount</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>price</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>vads_currency</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;953&#34;</span>, <span style=color:#75715e>// XPF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_payment_cards</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#75715e>// laisser vide pour afficher tous les types de cartes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_language</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;fr&#34;</span>, <span style=color:#75715e>// laisser &#39;fr&#39; car par défaut c&#39;est la langue &#39;en&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_theme_config</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;MODE_IFRAME=false;FORM_TARGET=_top&#39;</span>, <span style=color:#75715e>// affichage et comportement du theme, MODE_IFRAME=false =&gt; affichage complet, FORM_TARGET=_top =&gt; navigation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_redirect_success_timeout</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>, <span style=color:#75715e>// timeout du redirect après paiement accepté
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_redirect_error_timeout</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>, <span style=color:#75715e>// timeout du redirect après paiement refusé
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_url_success</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`http://localhost:3000/payment-result/success`</span>, <span style=color:#75715e>// url retour paiement accepté
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_url_return</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`http://localhost:3000/payment-result/fail`</span>, <span style=color:#75715e>// url retour paiement refusé
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>vads_return_mode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span> <span style=color:#75715e>// valeur nécessaire pour que le mode d&#39;affichage de la page de retour soit pris en compte
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      },
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>credentials</span> <span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#75715e>// endpoint retournant la signature du formulaire, cf. dossier backend
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>source</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`http://localhost:3001/sign`</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><p>C&rsquo;est tout pour notre frontend, passons maintenant au backend.</p><h1 id=backend>Backend<a hidden class=anchor aria-hidden=true href=#backend>#</a></h1><p>Pour notre backend, nous stockerons d&rsquo;abord notre certificat dans un fichier <em>.env</em> afin de ne pas le mettre en dur dans le code (et de ne pas le mettre dans git), en utilisant la librarie <em>dotenv</em>.</p><p>Nous ferons des requêtes à partir d&rsquo;un autre serveur (le frontend est sur le port 3000, et le backend sur le port 3001), et donc être confrontés à un problème de CORS, c&rsquo;est pourquoi nous utiliserons le module <em>cors</em>.</p><p>De plus, la librarie PayzenJS nous enverra un formulaire sous forme d&rsquo;objet JSON, pour pouvoir l&rsquo;interpréter, nous utilisons <em>body-parser</em>.</p><p>Enfin, nous devrons hasher et signer les données de notre formulaire, nous utiliserons la librarie <em>crypto-js</em> pour cela.</p><p>Ce qui nous donne les dépendances suivantes :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>/*</span> <span style=color:#960050;background-color:#1e0010>package.json</span> <span style=color:#960050;background-color:#1e0010>*/</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;dependencies&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;express&#34;</span>: <span style=color:#e6db74>&#34;4.17.2&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;cors&#34;</span>: <span style=color:#e6db74>&#34;2.8.5&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;crypto-js&#34;</span>: <span style=color:#e6db74>&#34;4.1.1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;dotenv&#34;</span>: <span style=color:#e6db74>&#34;16.0.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;body-parser&#34;</span>: <span style=color:#e6db74>&#34;1.20.0&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Installez les modules :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install
</span></span></code></pre></div><h2 id=dotenv>Dotenv<a hidden class=anchor aria-hidden=true href=#dotenv>#</a></h2><p>Dans le dossier backend, placez le certificat dans un fichier .env :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>touch .env
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># .env</span>
</span></span><span style=display:flex><span>CERTIFICATE<span style=color:#f92672>=</span>&lt;secret&gt;
</span></span></code></pre></div><p>Et récupérez-le dans le serveur :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// main.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;dotenv&#39;</span>).<span style=color:#a6e22e>config</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// modules serveur
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;express&#34;</span>);
</span></span><span style=display:flex><span>[...]
</span></span><span style=display:flex><span><span style=color:#75715e>// clé de la boutique disponible dans le back office commerçant Payzen
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>certificate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>CERTIFICATE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[...]
</span></span></code></pre></div><h2 id=cors>CORS<a hidden class=anchor aria-hidden=true href=#cors>#</a></h2><p>Utilisez <em>cors</em> dans votre serveur:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// main.js
</span></span></span><span style=display:flex><span><span style=color:#75715e>// modules serveur
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;express&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cors</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;cors&#39;</span>);
</span></span><span style=display:flex><span>[...]
</span></span><span style=display:flex><span><span style=color:#75715e>// middlewares
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cors</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>options</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#a6e22e>cors</span>());
</span></span><span style=display:flex><span>[...]
</span></span></code></pre></div><h2 id=body-parser>Body-parser<a hidden class=anchor aria-hidden=true href=#body-parser>#</a></h2><p>Utlisez <em>body-parser</em> dans votre serveur :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// main.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cors</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;cors&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bodyParser</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;body-parser&#39;</span>);
</span></span><span style=display:flex><span>[...]
</span></span><span style=display:flex><span><span style=color:#75715e>// middlewares
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cors</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>options</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#a6e22e>cors</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>bodyParser</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span>[...]
</span></span></code></pre></div><h2 id=signature>Signature<a hidden class=anchor aria-hidden=true href=#signature>#</a></h2><p>Avant de commencer à utiliser <em>crypto-js</em>, nous devons savoir quelles fonctions de cette librarie nous allons utiliser.</p><p><a href=https://secure.osb.pf/doc/fr-FR/form-payment/standard-payment/calculer-la-signature.html>Cette documentation</a> nous indique que nous devons utiliser <em><strong>hmacSHA256</strong></em> et <em><strong>Base64</strong></em>.</p><p><img loading=lazy src=fonctions_crypto.png#center alt="fonctions crypto" title="fonctions crypto"></p><p>Nous devons trier les noms de champs commençant par &ldquo;vads_&rdquo; par ordre alphabétique, concaténer leur valeur associée dans une variable, séparées par des &ldquo;+&rdquo;, et rajouter le certificat à la fin de cette variable.</p><p>Ce qui nous donne finalement ce fichier <em>main.js</em> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// main.js
</span></span></span><span style=display:flex><span><span style=color:#75715e>// dotenv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;dotenv&#39;</span>).<span style=color:#a6e22e>config</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// modules serveur
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;express&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cors</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;cors&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bodyParser</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;body-parser&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// modules signature
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>hmacSHA256</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;crypto-js/hmac-sha256&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Base64</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;crypto-js/enc-base64&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>port</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3001</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// middlewares
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cors</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>options</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#a6e22e>cors</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>bodyParser</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// clé de la boutique disponible dans le back office commerçant Payzen
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>certificate</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>CERTIFICATE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/sign&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>orderData</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>orderData</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// transformer les données de orderData en chaine : &#34;VALEUR_1+VALEUR_2+...+VALEUR_N+CERTIFICAT&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dataToSign</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>orderData</span>).<span style=color:#a6e22e>sort</span>().<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>key</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>key</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>5</span>) <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;vads_&#39;</span>) {
</span></span><span style=display:flex><span>	    <span style=color:#a6e22e>dataToSign</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>orderData</span>[<span style=color:#a6e22e>key</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>+`</span>;
</span></span><span style=display:flex><span>	  }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dataToSign</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>certificate</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// calcul de la signature, l&#39;algorithme à utiliser est défini dans le back office commerçant Payzen
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>signature</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Base64</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>hmacSHA256</span>(<span style=color:#a6e22e>dataToSign</span>, <span style=color:#a6e22e>certificate</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// retourner la signature
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>send</span>({<span style=color:#a6e22e>signature</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>signature</span>});
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#a6e22e>port</span>, () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Payzen e-shopping backend server listening on port </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>port</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h1 id=test>Test<a hidden class=anchor aria-hidden=true href=#test>#</a></h1><p>Nous sommes maintenant prêts à tester notre application.</p><p><img loading=lazy src=home_test.png#center alt="Home test" title="Home test"></p><p>En cliquant sur le bouton <em>Buy</em> du premier <em>Item</em> nous voyons le formulaire de paiement s&rsquo;afficher dans la modale.</p><p><img loading=lazy src=formulaire_paiement.png#center alt="Formulaire de paiement" title="Formulaire de paiement"></p><p>Attention: les données de test sont uniquement possibles si vous avez bien spécifié la valeur <em><strong>TEST</strong></em> dans le paramètre <em><strong>vads_ctx_mode</strong></em>.</p><p>En cliquant sur une des cartes, par exemple &ldquo;Banque Socredo Verte&rdquo;, nous voyons une liste de cartes de test. En cliquant sur l&rsquo;une d&rsquo;entre elle, le formulaire va automatiquement remplir les champs.</p><p><img loading=lazy src=formulaire_carte_socredo.png#center alt="Formulaire - Carte Socredo Verte" title="Formulaire - carte Socredo Verte"></p><p>Remarque : À côté de chaque carte se trouve un scénario associé, si vous voulez tester un paiement accepté, vous devez choisir la 1ère carte.</p><p>Puis, en cliquant sur valider, vous verrez le formulaire pour le code reçu par SMS, aussi appelé OTP pour <em>One Time Password</em>.</p><p>En mode TEST, vous pouvez juste recopier la valeur affichée, ou cliquer sur la valeur.</p><p><img loading=lazy src=formulaire_OTP.png#center alt="Formulaire - OTP" title="Formulaire - OTP"></p><p>Enfin, si vous avez bien choisi la carte associé au &ldquo;paiement accepté&rdquo;, vous obtiendrez l&rsquo;écran de commande validée.</p><p><img loading=lazy src=formulaire_paiement_valide.png#center alt="Formulaire - Paiement validé" title="Formulaire - Paiement validé"></p><p>Vous pouvez ensuite soit attendre la redirection automatique, soit cliquer sur &ldquo;retourner à la boutique&rdquo;, pour aller sur la page /payment-result/success.</p><p><img loading=lazy src=page_paiement_reussi.png#center alt="Page paiement validé" title="Page paiement validé"></p><p>Nous voyons dans les DevTools que cette redirection est en fait une requête POST, avec les données suivantes.</p><p><img loading=lazy src=page_paiement_reussi_data.png#center alt="Page paiement validé - Data" title="Page paiement validé - Data"></p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>Dans cet article, nous avons utilisé la librarie PayzenJS afin d&rsquo;afficher le formulaire de paiement dans une iframe contenue dans une modale.</p><p>Nous avons ainsi réussi à faire un paiement, et nous avons été redirigé vers la page de paiement réussi de notre application web.</p><p>Mais le travail ne s&rsquo;arrête pas ici, en effet, une fois que le paiement est effectué, validé ou non, il nous reste à exploiter les données de retour afin de déclencher la suite de la commande, ou d&rsquo;avertir le client que sa commande n&rsquo;est pas passée.</p><p>De plus, nous devons valider qu&rsquo;il s&rsquo;agit bien de notre transaction, et non d&rsquo;une requête forgée.</p><p>Nous verrons cela dans le prochain article.</p></div><footer class=post-footer><nav class=paginav><a class=next href=https://huangmanutea.github.io/blog.dev/posts/payzen_e-shopping_formulaire/inventaire/><span class=title>Next Page »</span><br><span>Payzen e-shopping formulaire - Inventaire</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Payzen e-shopping formulaire - Paiement on twitter" href="https://twitter.com/intent/tweet/?text=Payzen%20e-shopping%20formulaire%20-%20Paiement&url=https%3a%2f%2fhuangmanutea.github.io%2fblog.dev%2fposts%2fpayzen_e-shopping_formulaire%2fpaiement%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Payzen e-shopping formulaire - Paiement on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fhuangmanutea.github.io%2fblog.dev%2fposts%2fpayzen_e-shopping_formulaire%2fpaiement%2f&title=Payzen%20e-shopping%20formulaire%20-%20Paiement&summary=Payzen%20e-shopping%20formulaire%20-%20Paiement&source=https%3a%2f%2fhuangmanutea.github.io%2fblog.dev%2fposts%2fpayzen_e-shopping_formulaire%2fpaiement%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Payzen e-shopping formulaire - Paiement on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fhuangmanutea.github.io%2fblog.dev%2fposts%2fpayzen_e-shopping_formulaire%2fpaiement%2f&title=Payzen%20e-shopping%20formulaire%20-%20Paiement"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Payzen e-shopping formulaire - Paiement on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fhuangmanutea.github.io%2fblog.dev%2fposts%2fpayzen_e-shopping_formulaire%2fpaiement%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Payzen e-shopping formulaire - Paiement on whatsapp" href="https://api.whatsapp.com/send?text=Payzen%20e-shopping%20formulaire%20-%20Paiement%20-%20https%3a%2f%2fhuangmanutea.github.io%2fblog.dev%2fposts%2fpayzen_e-shopping_formulaire%2fpaiement%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Payzen e-shopping formulaire - Paiement on telegram" href="https://telegram.me/share/url?text=Payzen%20e-shopping%20formulaire%20-%20Paiement&url=https%3a%2f%2fhuangmanutea.github.io%2fblog.dev%2fposts%2fpayzen_e-shopping_formulaire%2fpaiement%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://huangmanutea.github.io/blog.dev/>HUANG Manutea</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement('button');e.classList.add('copy-code'),e.innerText='copy';function s(){e.innerText='copied!',setTimeout(()=>{e.innerText='copy'},2e3)}e.addEventListener('click',o=>{if('clipboard'in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand('copy'),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>